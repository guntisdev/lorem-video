version: '3'

tasks:
  run:
    desc: Run development server with auto-reload
    cmds:
      - find . -name '*.go' | entr -r go run ./cmd/server

  build:
    desc: Build server binary
    cmds:
      - go build -o bin/server ./cmd/server

  test:
    desc: Test all packages
    cmds:
      - gotestsum --format testname

  test:integration:
    desc: Run all integration tests (requires FFmpeg)
    cmds:
      - gotestsum --format testname -- -tags=integration -v ./internal/service

  test:integration:long:
    desc: Run a longer AV1 test to see encoding performance
    cmds:
      - gotestsum --format testname -- -tags=integration -v -run=TestLongAV1 ./internal/service

  deps:
    desc: Download dependencies
    cmds:
      - go mod download
      - go mod tidy
